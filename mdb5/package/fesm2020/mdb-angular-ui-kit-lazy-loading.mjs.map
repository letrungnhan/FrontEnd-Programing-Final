{"version":3,"file":"mdb-angular-ui-kit-lazy-loading.mjs","sources":["../../../projects/mdb-angular-ui-kit/lazy-loading/lazy-loading.utils.ts","../../../projects/mdb-angular-ui-kit/lazy-loading/lazy-loading.directive.ts","../../../projects/mdb-angular-ui-kit/lazy-loading/lazy-loading.module.ts","../../../projects/mdb-angular-ui-kit/lazy-loading/mdb-angular-ui-kit-lazy-loading.ts"],"sourcesContent":["export function isImage(element: Element) {\n  return element.nodeName === 'IMG';\n}\n\nexport function isVideo(element: Element) {\n  return element.nodeName === 'VIDEO';\n}\n","import {\n  Directive,\n  ElementRef,\n  EventEmitter,\n  Input,\n  NgZone,\n  OnDestroy,\n  OnInit,\n  Output,\n  Renderer2,\n} from '@angular/core';\nimport { fromEvent, Subscription } from 'rxjs';\nimport { take } from 'rxjs/operators';\nimport { isImage, isVideo } from './lazy-loading.utils';\n\n@Directive({\n  selector: '[mdbLazyLoading]',\n})\nexport class MdbLazyLoadingDirective implements OnInit, OnDestroy {\n  @Input() offset = 0;\n  @Input() loadingPlaceholder: string;\n  @Input() errorPlaceholder: string;\n  @Input() container: HTMLElement;\n  @Input() delay = 0;\n\n  @Output() loadingStart: EventEmitter<void> = new EventEmitter<void>();\n  @Output() loadingEnd: EventEmitter<void> = new EventEmitter<void>();\n  @Output() loadingError: EventEmitter<void> = new EventEmitter<void>();\n\n  private _scrollSubscription: Subscription;\n\n  constructor(\n    private _elementRef: ElementRef,\n    private _renderer: Renderer2,\n    private _ngZone: NgZone\n  ) {}\n\n  get host(): HTMLElement {\n    return this._elementRef.nativeElement;\n  }\n\n  ngOnInit(): void {\n    this._initObserver();\n\n    if (this.loadingPlaceholder) {\n      this._setPlaceholder(this.host, this.loadingPlaceholder);\n    }\n  }\n\n  ngOnDestroy(): void {\n    if (this._scrollSubscription) {\n      this._scrollSubscription.unsubscribe();\n    }\n  }\n\n  private _initObserver(): void {\n    const target = this.container || window;\n\n    this._ngZone.runOutsideAngular(() => {\n      this._scrollSubscription = fromEvent(target, 'scroll').subscribe(() => {\n        this._handleScroll();\n      });\n    });\n  }\n\n  private _handleScroll(): void {\n    if (this._isInViewport()) {\n      this._ngZone.run(() => {\n        this._lazyLoad(this.host);\n      });\n    }\n  }\n\n  private _isInViewport(): boolean {\n    const elementRect = this.host.getBoundingClientRect();\n\n    if (this.container) {\n      const containerRect = this.container.getBoundingClientRect();\n      return (\n        containerRect.y > 0 &&\n        containerRect.y < window.innerHeight &&\n        elementRect.y >= containerRect.y &&\n        elementRect.y <= containerRect.y + containerRect.height &&\n        elementRect.y <= window.innerHeight\n      );\n    }\n\n    return elementRect.top + this.offset <= window.innerHeight && elementRect.bottom >= 0;\n  }\n\n  private _lazyLoad(element: HTMLElement) {\n    this._scrollSubscription.unsubscribe();\n    this.loadingStart.emit();\n\n    setTimeout(() => {\n      if (isImage(element)) {\n        this._loadImage(element as HTMLImageElement);\n      } else if (isVideo(element)) {\n        this._loadVideo(element as HTMLVideoElement);\n      }\n    }, this.delay);\n  }\n\n  private _loadImage(element: HTMLImageElement) {\n    if (!element.dataset.src) {\n      this.loadingError.emit();\n\n      if (this.errorPlaceholder) {\n        this._setPlaceholder(element, this.errorPlaceholder);\n      }\n\n      return;\n    }\n\n    this._handleLoadingEvents(element);\n\n    this._renderer.setAttribute(element, 'src', element.dataset.src);\n    this._renderer.removeAttribute(element, 'data-src');\n  }\n\n  private _loadVideo(element: HTMLVideoElement) {\n    if (!element.dataset.src) {\n      this.loadingError.emit();\n\n      if (this.errorPlaceholder) {\n        this._setPlaceholder(element, this.errorPlaceholder);\n      }\n\n      return;\n    }\n\n    this._handleLoadingEvents(element);\n\n    this._renderer.setAttribute(element, 'src', element.dataset.src);\n    this._renderer.removeAttribute(element, 'data-src');\n    this._renderer.removeAttribute(element, 'poster');\n  }\n\n  private _handleLoadingEvents(element: HTMLElement) {\n    fromEvent(element, 'load')\n      .pipe(take(1))\n      .subscribe(() => {\n        this.loadingEnd.emit();\n      });\n\n    fromEvent(element, 'error')\n      .pipe(take(1))\n      .subscribe(() => {\n        this.loadingError.emit();\n\n        if (this.errorPlaceholder) {\n          this._setPlaceholder(element, this.errorPlaceholder);\n        }\n      });\n  }\n\n  private _setPlaceholder(element: any, placeholder: string): void {\n    if (element.nodeName === 'IMG') {\n      this._renderer.setAttribute(element, 'src', placeholder);\n    } else if (element.nodeName === 'VIDEO') {\n      this._renderer.setAttribute(element, 'poster', placeholder);\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { MdbLazyLoadingDirective } from './lazy-loading.directive';\n\n@NgModule({\n  imports: [CommonModule],\n  declarations: [MdbLazyLoadingDirective],\n  exports: [MdbLazyLoadingDirective],\n})\nexport class MdbLazyLoadingModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n"],"names":[],"mappings":"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"}